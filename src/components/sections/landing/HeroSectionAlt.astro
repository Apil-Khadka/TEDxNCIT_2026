---
import CountdownTimer from './CountdownTimer.tsx';
const { 
  eventDate, 
  subTitle, 
  title = "Explore the Unexplored",
  fontSize = "clamp(2.5rem, 6vw, 5rem)",
  pulseTempo = "0.2s",
} = Astro.props;
---

<section class="relative mx-auto max-w-[95rem] px-4 pb-24 pt-10 sm:px-6 lg:px-8 text-center">
  <div class="mx-auto mt-5 w-full relative flex justify-center items-center">
    <div class="mysteryWrapper">
      <h1 
        class="mysteryText" 
        id="animatedTitle"
        style={`--font-size: ${fontSize}; --pulse-tempo: ${pulseTempo};`}
      >
        {title}
      </h1>
    </div>
  </div>
  <div class="mx-auto mt-8 max-w-xl">
    <p class="text-lg text-neutral-600 dark:text-neutral-400">
      {subTitle ?? "Journey beyond boundaries. Seek what's unseen."}
    </p>
    <CountdownTimer eventDate={eventDate} client:idle />
  </div>
</section>

<style>
.mysteryWrapper {
  position: relative;
  display: inline-block;
  overflow: visible;
  padding: 1rem 2rem;
  width: 100%;
  max-width: 100%;
}

.mysteryText {
  display: inline-block;
  font-size: var(--font-size);
  font-weight: 800;
  text-transform: uppercase;
  color: #eb0028;
  letter-spacing: 0.05em;
  line-height: 1.1;
  position: relative;
  z-index: 2;
  white-space: normal;
}

/* Individual character/word styling */
.char, .word {
  display: inline-block;
  transform-origin: center;
}
</style>

<script>
  import Splitting from 'splitting';
  import gsap from 'gsap';
  import 'splitting/dist/splitting.css';

  // Split text into characters
  const result = Splitting({ target: '#animatedTitle', by: 'chars' });
  const chars = result[0].chars;

  // Create timeline for complex animations
  const tl = gsap.timeline({ repeat: -1 });

  // Pulse effect (like heartbeat)
  gsap.to('#animatedTitle', {
    scale: 1.001,
    duration: 0.1,
    repeat: -1,
    yoyo: true,
    repeatDelay: 0.7,
    ease: 'power2.inOut',
    filter: 'drop-shadow(0 0 25px rgba(135, 0, 40, 0.9))',
  });

  // Random character disappear/appear
  function randomGlitch() {
    const randomChars = gsap.utils.shuffle([...chars]).slice(0, Math.floor(Math.random() * 5) + 3);
    
    gsap.to(randomChars, {
      opacity: 0,
      y: gsap.utils.random(-20, 20),
      rotation: gsap.utils.random(-15, 15),
      duration: 0.1,
      stagger: 0.02,
      yoyo: true,
      repeat: 1,
    });
  }

  // Directional wipes
  function directionalWipe(direction) {
    const indexFunc = direction === 'left' ? (i) => i : (i) => chars.length - i;
    
    gsap.fromTo(chars, 
      { clipPath: direction === 'left' ? 'inset(0 100% 0 0)' : 'inset(0 0 0 100%)' },
      {
        clipPath: 'inset(0 0 0 0)',
        duration: 0.5,
        stagger: {
          each: 0.03,
          from: direction === 'left' ? 'start' : 'end',
        },
        ease: 'power2.out',
      }
    );
  }

  // Wave effect
  function waveEffect() {
    gsap.to(chars, {
      y: -20,
      duration: 0.3,
      stagger: {
        each: 0.05,
        repeat: 1,
        yoyo: true,
      },
      ease: 'sine.inOut',
    });
  }

  // Main animation sequence
  setInterval(() => {
    const animations = [
      () => randomGlitch(),
      () => directionalWipe('left'),
      () => directionalWipe('right'),
      () => waveEffect(),
    ];
    
    const randomAnim = animations[Math.floor(Math.random() * animations.length)];
    randomAnim();
  }, 3000);
</script>
